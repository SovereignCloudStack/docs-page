"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9612],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>d});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),u=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},p=function(e){var t=u(e.components);return n.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=u(a),d=r,h=m["".concat(l,".").concat(d)]||m[d]||c[d]||i;return a?n.createElement(h,o(o({ref:t},p),{},{components:a})):n.createElement(h,o({ref:t},p))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var u=2;u<i;u++)o[u]=a[u];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},4974:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>i,metadata:()=>s,toc:()=>u});var n=a(7462),r=(a(7294),a(3905));const i={title:"Requirements for container registry",type:"Decision Record",status:"Draft",track:"KaaS"},o=void 0,s={unversionedId:"active/scs-0212-v1-requirements-for-container-registry",id:"active/scs-0212-v1-requirements-for-container-registry",title:"Requirements for container registry",description:"Introduction",source:"@site/standards/active/scs-0212-v1-requirements-for-container-registry.md",sourceDirName:"active",slug:"/active/scs-0212-v1-requirements-for-container-registry",permalink:"/standards/active/scs-0212-v1-requirements-for-container-registry",draft:!1,tags:[],version:"current",frontMatter:{title:"Requirements for container registry",type:"Decision Record",status:"Draft",track:"KaaS"}},l={},u=[{value:"Introduction",id:"introduction",level:2},{value:"Motivation",id:"motivation",level:2},{value:"Design considerations",id:"design-considerations",level:2},{value:"OSS health check",id:"oss-health-check",level:3},{value:"Required and desirable features check",id:"required-and-desirable-features-check",level:3},{value:"Required features",id:"required-features",level:4},{value:"Desirable features",id:"desirable-features",level:4},{value:"Conclusion",id:"conclusion",level:3},{value:"Decision",id:"decision",level:2}],p={toc:u};function c(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"A container registry is an infrastructure service to enable storing and accessing container\nimages. Images can be pushed to the registry by e.g. Continuous integration pipelines and\nbe pulled from by runtime environments like Kubernetes clusters."),(0,r.kt)("p",null,"Container registries could be publicly accessible e.g. Docker Hub, could be\nself-hosted or hosted by cloud service providers (CSP). These container registries may\napply various access control mechanisms to restrict public access and make them private.\nBoth solutions offer a wide range of features that may or may not attract potential\nusers and CSPs."),(0,r.kt)("h2",{id:"motivation"},"Motivation"),(0,r.kt)("p",null,"This proposal is motivated by use cases in which CSPs would like to offer\nprivate container registries to their customers. The specific use cases should be\ndiscussed, but overall CSP could offer a private container registry as a service or\nCSP could offer a recipe (maintained by SCS) for customers to deploy the private\nregistry themselves utilizing CSP infrastructure. In both cases, the private\ncontainer registry should fulfill a set of needed requirements e.g. for security and\nprivacy."),(0,r.kt)("p",null,"The idea and purpose of this document is to specify what requirements a\nspecific technical container registry implementation (i.e. software solution) needs to\nfulfill in the context of SCS."),(0,r.kt)("p",null,"Another purpose is the selection of an appropriate container registry\nimplementation that meets all defined requirements to make architectural\ndecision on what implementation will be used by the SCS."),(0,r.kt)("h2",{id:"design-considerations"},"Design considerations"),(0,r.kt)("p",null,"There are numerous features to look for when evaluating a container registry solution.\nOur decision process goes through two main stages:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"#oss-health-check"},"OSS health check")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"#required-and-desirable-features-check"},"Required and desirable features check"))),(0,r.kt)("p",null,"The open-source software (OSS) health check is the first filter stage. This stage is\ncrucial in the context of SCS and container registry implementation should pass it to\npromote itself to the second consideration stage. The second stage provides an overview\nover the feature set of open source container registry implementations and map out\nrequirements (and nice-to-haves) against it to have a well-documented decision."),(0,r.kt)("p",null,"Note: Keep in mind that at the time of writing this document, we've made our best effort\nto survey the container registry landscape based on publicly available materials.\nIf you find something outdated (with respect to the time of writing this document) or\noutright erroneous, please submit a PR or raise an issue, and we'll fix it right away."),(0,r.kt)("h3",{id:"oss-health-check"},"OSS health check"),(0,r.kt)("p",null,"This section evaluates the health of the open-source projects that were selected from\nthe currently available solutions. The container registry software must fulfill all OSS\nhealth checks defined by the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/SovereignCloudStack/standards/blob/main/Drafts/OSS-Health.md"},"OSS-Health"),"\ndocument. The main health checks are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Four Opens (code is fully open source, community is open and diverse, development\nprocess is open, design process is open)"),(0,r.kt)("li",{parentName:"ul"},"Maturity"),(0,r.kt)("li",{parentName:"ul"},"Security"),(0,r.kt)("li",{parentName:"ul"},"Activity"),(0,r.kt)("li",{parentName:"ul"},"Lock-in risk assessment")),(0,r.kt)("p",null,"Each selected OSS project is evaluated based on the above checks, and it is classified\ninto one of three categories as follows:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u2714\ufe0f The project passed all OSS health checks and will be considered\nfurther as a valid candidate.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u2754 The project passed almost all OSS health checks.\nThere is place for improvement, but the missing points are not crucial from the OSS\nhealth check perspective. The project will be considered further as a valid candidate.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u274c The project does not pass the OSS health checks. Some OSS health check\nshowstoppers have been found (e.g. open core software, not actively maintained).\nThe project is filtered at this stage and won't be considered further."))),(0,r.kt)("p",null,"Refer to the list of evaluated projects with their classified categories and comments."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u2714\ufe0f ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/goharbor/harbor"},"Harbor")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},'Harbor project meets all "four opens"',(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Source code is open and available under the ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/goharbor/harbor/blob/main/LICENSE"},"Apache 2 license")),(0,r.kt)("li",{parentName:"ul"},"Community is ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/goharbor/harbor#community"},"open"),", structured and\nwell organized via ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/goharbor/community"},"workgroups")," and\nvarious communications channels e.g. Slack, mailing lists, etc.\n(#harbor Slack channel contains 3k+ members)"),(0,r.kt)("li",{parentName:"ul"},"The development process is open via GitHub issues and well described in the\n",(0,r.kt)("a",{parentName:"li",href:"https://github.com/goharbor/harbor/blob/main/CONTRIBUTING.md"},"contributing"),"\ndocument"),(0,r.kt)("li",{parentName:"ul"},"The design process is open via GitHub issues. Proposals are ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/goharbor/community/tree/main/proposals"},"public"),".\nThe decision process is well described as well. The project's roadmap is\navailable in the ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/goharbor/harbor/blob/main/ROADMAP.md"},"roadmap")," document"))),(0,r.kt)("li",{parentName:"ul"},"Maturity is on the CNCF ",(0,r.kt)("a",{parentName:"li",href:"https://www.cncf.io/projects/harbor/"},"graduation")," level.\nCNCF graduated projects are considered to be stable, widely adopted and production-ready"),(0,r.kt)("li",{parentName:"ul"},"Security",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"The security disclosure and response policy is well described in the project's\n",(0,r.kt)("a",{parentName:"li",href:"https://github.com/goharbor/harbor/blob/main/SECURITY.md"},"security")," document"),(0,r.kt)("li",{parentName:"ul"},"The code is reviewed within a standard PR process"))),(0,r.kt)("li",{parentName:"ul"},"Activity",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"250+ contributors, 4k+ forks, 13k+ GitHub stars"),(0,r.kt)("li",{parentName:"ul"},"The project has been ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/goharbor/harbor/blob/main/ADOPTERS.md"},"adopted"),"\nby many companies that run Harbor in their production environments"),(0,r.kt)("li",{parentName:"ul"},"The project collaborates with other communities and projects\n(see ",(0,r.kt)("a",{parentName:"li",href:"https://goharbor.io/community/"},"Partners of Harbor")," section of the\nproject's website)"),(0,r.kt)("li",{parentName:"ul"},"The project is visible and actively contributes to various conferences, e.g.\n",(0,r.kt)("a",{parentName:"li",href:"https://goharbor.io/blog/harbor-at-fosdem-2022/"},"FOSDEM 22"),",\n",(0,r.kt)("a",{parentName:"li",href:"https://www.youtube.com/watch?v=REgvBPH369M"},"KubeCon Europe"),", etc."))),(0,r.kt)("li",{parentName:"ul"},"Lock-in risk assessment",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"The project's ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/goharbor/community/blob/main/MAINTAINERS.md"},"maintainers"),"\ndocument shows that there are a sufficient number of core\nmaintainers/contributors that differ over various companies, we therefore deem\nthe lock-in risk arising from a single point of failure to be low"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u2714\ufe0f ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/dragonflyoss/Dragonfly2"},"Dragonfly")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},'Dragonfly project meets all "four opens"',(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Source code is open and available under the ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/dragonflyoss/Dragonfly2/blob/main/LICENSE"},"Apache 2 license")),(0,r.kt)("li",{parentName:"ul"},"Community is ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/dragonflyoss/Dragonfly2#community"},"open"),"\norganized via multiple channels e.g. Slack, mailing lists, etc.\n(#dragonfly Slack channel contains ~50 members)"),(0,r.kt)("li",{parentName:"ul"},"The development process is open via GitHub issues and well described in the\n",(0,r.kt)("a",{parentName:"li",href:"https://github.com/dragonflyoss/Dragonfly2/blob/main/CONTRIBUTING.md"},"contributing")," document"),(0,r.kt)("li",{parentName:"ul"},"The design process is open via GitHub issues. The project's roadmap is available in\nthe project's ",(0,r.kt)("a",{parentName:"li",href:"https://d7y.io/docs/others/roadmap/#2022-roadmap"},"webpage")))),(0,r.kt)("li",{parentName:"ul"},"Maturity is on the CNCF ",(0,r.kt)("a",{parentName:"li",href:"https://www.cncf.io/projects/dragonfly/"},"incubating")," level\nCNCF incubating project is considered stable and used in production by users with\nthe healthy pool of contributors"),(0,r.kt)("li",{parentName:"ul"},"Security",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"The security disclosure is handled via a dedicated email address"),(0,r.kt)("li",{parentName:"ul"},"The code is reviewed within a standard PR process"))),(0,r.kt)("li",{parentName:"ul"},"Activity",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"30+ contributors, 100+ forks, 1k+ GitHub stars"),(0,r.kt)("li",{parentName:"ul"},"The project has been ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/dragonflyoss/Dragonfly2/blob/main/ADOPTERS.md"},"adopted"),"\nby many companies that run Harbor in their production environments"),(0,r.kt)("li",{parentName:"ul"},"The project is visible and actively contributes to various conferences,\ne.g. ",(0,r.kt)("a",{parentName:"li",href:"https://www.youtube.com/watch?v=LcxBgmmeA80"},"KubeCon North America"),",\n",(0,r.kt)("a",{parentName:"li",href:"https://www.youtube.com/watch?v=MGNtPHQYP14"},"KubeCon Europe"),", etc."))),(0,r.kt)("li",{parentName:"ul"},"Lock-in risk assessment",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"The list of the project's ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/dragonflyoss/Dragonfly2/blob/main/MAINTAINERS.md"},"maintainers"),"\nincludes contributors from various companies and the ",(0,r.kt)("a",{parentName:"li",href:"https://dragonfly.devstats.cncf.io/d/7/companies-contributing-in-repository-groups"},"companies contributing dashboard"),"\nshows that ~10 companies are actively contributing to a repository group"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u2754 ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/quay/quay"},"Project Quay")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},'Project Quay meets all "four opens"',(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Source code is open and available under the ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/quay/quay/blob/master/LICENSE"},"Apache 2 license")),(0,r.kt)("li",{parentName:"ul"},"Community is ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/quay/quay#community"},"open")," organized via mailing\nlist and IRC"),(0,r.kt)("li",{parentName:"ul"},"Development process is open via ",(0,r.kt)("a",{parentName:"li",href:"https://issues.redhat.com/projects/PROJQUAY/issues"},"JBoss JIRA"),"\nissues and well described in the ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/quay/quay/blob/master/GOVERNANCE.md"},"governance")," document"),(0,r.kt)("li",{parentName:"ul"},"Design process is open via ",(0,r.kt)("a",{parentName:"li",href:"https://issues.redhat.com/projects/PROJQUAY/issues"},"JBoss JIRA"),"\nissues. The project's roadmap is available on the project's ",(0,r.kt)("a",{parentName:"li",href:"https://www.projectquay.io/#contribute"},"webpage")))),(0,r.kt)("li",{parentName:"ul"},"Maturity",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Project Quay is an open-source project that starts ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/quay/quay/commit/0349af754204375d74ac5833713b607398981ff7"},"~9 years ago"),".\nIt powers Red Hat enterprise products Red Hat Quay and Quay.io, which are used in\na productive way by many. Therefore, the project's maturity is at the good level"))),(0,r.kt)("li",{parentName:"ul"},"Security",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"The security disclosure is handled via a dedicated email address"),(0,r.kt)("li",{parentName:"ul"},"The code is reviewed within a standard PR process"))),(0,r.kt)("li",{parentName:"ul"},"Activity",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"50+ contributors, 200+ forks, 2k+ GitHub stars"),(0,r.kt)("li",{parentName:"ul"},"The project has been used by many ",(0,r.kt)("a",{parentName:"li",href:"https://www.projectquay.io"},"companies")," that\nrun Quay in their production environments"))),(0,r.kt)("li",{parentName:"ul"},"Lock-in risk assessment",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"The project's owners/maintainers list is not publicly available and is stored in\nthe ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/quay/quay-docs#how-do-i-set-up"},"downstream repository"),".\nTherefore, it is hard to distinguish the risk of project failure caused by low\ndiversity across the companies. This should be improved"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u274c ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/sapcc/keppel"},"Keppel")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"The project seems to be not widely used in a productive way and also the activity\naround is currently not on a good level (5+ contributors). The development\nprocess as well as the design process seem to be open, but not documented yet"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u274c ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/sonatype/nexus-public"},"Nexus")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Nexus is an ",(0,r.kt)("strong",{parentName:"li"},"open core")," software that offers paid ",(0,r.kt)("a",{parentName:"li",href:"https://www.sonatype.com/products/repository-oss-vs-pro-features"},"pro version")," with advanced features"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u274c ",(0,r.kt)("a",{parentName:"p",href:"https://jfrog.com/community/open-source/"},"JFrog")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"JFrog Artifactory is shipped as an ",(0,r.kt)("strong",{parentName:"li"},"open core")," ",(0,r.kt)("a",{parentName:"li",href:"https://jfrog.com/community/open-source/"},"software"),"\nwith limited features. The software is primarily offered as a paid ",(0,r.kt)("a",{parentName:"li",href:"https://jfrog.com/pricing/#devops-onprem"},"pro version")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u274c ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/uber/kraken"},"Kraken")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"It seems that the project is not actively maintained as is discussed in the related\nproject's ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/uber/kraken/issues/313"},"issue")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u274c ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/SUSE/Portus"},"Portus")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"It seems that the project is not actively maintained as is discussed in the related\nproject's ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/SUSE/Portus/issues/2352"},"issue"))))),(0,r.kt)("h3",{id:"required-and-desirable-features-check"},"Required and desirable features check"),(0,r.kt)("p",null,"This section provides an overview of the feature set of open source container registry\nimplementations (which passed the OSS health stage above) and map out requirements\n(and nice-to-haves) against it. The container registry software must be robust enough,\nto be able to operate under heavy load (e.g. high availability (HA) mode, federation, etc.) and\nthe crucial feature is security.\nWe defined a set of required features that the container registry implementation must\nhave and also a set of desirable (nice to have) features are defined and evaluated here."),(0,r.kt)("h4",{id:"required-features"},"Required features"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Audit Logs",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Ability to record use in auditable logs so that activity can be traced to a single user"))),(0,r.kt)("li",{parentName:"ul"},"Authentication of system identities",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},'Support for authenticating system identities like Kubernetes clusters. Ideally supporting dynamic identity tokens from some IdP; Less ideal: Supporting static "system tokens"'))),(0,r.kt)("li",{parentName:"ul"},"Authentication of users",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Support for multiple authentication systems (IdM integration). User and user account management"))),(0,r.kt)("li",{parentName:"ul"},"Authorization",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Role-based access control to ensure strict access controls"))),(0,r.kt)("li",{parentName:"ul"},"Automation",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Integration with CI/CD tools e.g. via webhooks"))),(0,r.kt)("li",{parentName:"ul"},"Vulnerability scanning",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Reveal security vulnerabilities in container images"))),(0,r.kt)("li",{parentName:"ul"},"Content Trust and Validation",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Verify image authenticity before running - image signing"))),(0,r.kt)("li",{parentName:"ul"},"Multi-tenancy",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Container registry is able to serve multiple tenants (projects, teams, namespaces). It can be implemented also on the storage level, see e.g. ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/sapcc/keppel#overview"},"Keppel")))),(0,r.kt)("li",{parentName:"ul"},"Backup and restore",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"It is important for disaster recovery and data migration scenarios"))),(0,r.kt)("li",{parentName:"ul"},"Monitoring",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Observability is a key feature for operating a service in production so the container registry should expose key metrics"))),(0,r.kt)("li",{parentName:"ul"},"HA mode",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Ensure system uptime even in the event of a failure"))),(0,r.kt)("li",{parentName:"ul"},"Registry replication",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Replication allows users to replicate container images between registries of the same instances and between registries of different instances as well"))),(0,r.kt)("li",{parentName:"ul"},"Proxy cache (pull-through cache)",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Proxy cache allows you to use a container registry to proxy and cache images from a target public or private registry"))),(0,r.kt)("li",{parentName:"ul"},"Quota management",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Control over resource use"))),(0,r.kt)("li",{parentName:"ul"},"Garbage collection",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Removing blobs from the filesystem when they are no longer referenced by a manifest"))),(0,r.kt)("li",{parentName:"ul"},"Retention policy",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Reduce the number of image tags, many of which might not be required after a given time or once a subsequent image tag has superseded them")))),(0,r.kt)("h4",{id:"desirable-features"},"Desirable features"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Additionally supported artifacts",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Additional artifacts that the registry is able to store in addition to OCI artifacts, e.g. Java, Node.js, or Python packages"))),(0,r.kt)("li",{parentName:"ul"},"Integration possibilities",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Ability to cooperate with another software solution in order to improve own feature set (e.g. integration of P2P solution for improving container image distribution (download speed and stability, high scalability ...))"))),(0,r.kt)("li",{parentName:"ul"},"Deployment capabilities",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},'How could be a container registry deployed (only "official" ways are mentioned)'))),(0,r.kt)("li",{parentName:"ul"},'Administration capabilities "as a code"',(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},'Ability to manage container registry via "as a code" solutions, e.g. Ansible role')))),(0,r.kt)("p",null,"Refer to the table of evaluated projects with their features. Note that only container\nregistry implementations that passed the OSS health stage (Harbor, Quay, and Dragonfly)\nare evaluated here."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Features"),(0,r.kt)("th",{parentName:"tr",align:null},"Harbor"),(0,r.kt)("th",{parentName:"tr",align:null},"Quay"),(0,r.kt)("th",{parentName:"tr",align:null},"Dragonfly"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Audit Logs"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2717")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Authentication of system identities"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Robot Accounts"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Robot Accounts"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2717")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Authentication of users"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Local database, LDAP, OIDC, UAA"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Local database, LDAP, Keystone, JWT"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Local database")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Authorization"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Automation"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Webhooks (HTTP, Slack)"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Webhooks (HTTP, Slack, E-mail ...), building images"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2717")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Vulnerability scanning"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Trivy, Clair"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Clair"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2717")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Content Trust and Validation"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Cosign"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Cosign"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2717")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Multi-tenancy"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 (not on the storage level)"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 (not on the storage level)"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 (not on the storage level)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Backup and restore"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2717")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Monitoring"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Prometheus metrics, Tracing"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Prometheus metrics, Tracing (only for Clair)"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Prometheus metrics, Tracing")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"HA mode"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2717")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Registry replication"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Proxy cache"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Feature is in the technology preview stage (non production ready)"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2717")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Quota management"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Based on storage consumption"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Based on storage consumption"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2717")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Garbage collection"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Non-blocking"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Non-blocking"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2717")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Retention policy"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Multiple tag retention rules"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Only tag expiration rules"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2717")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Additional supported artifacts"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2717 (only OCI artifacts)"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2717 (only OCI artifacts)"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Maven, YUM")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Integration possibilities"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Dragonfly (P2P), Kraken (P2P)"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2717"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Harbor, Nydus, eStargz")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Deployment capabilities"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Docker-compose, Helm chart, Operator"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Docker-compose, Operator"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Docker-compose, Helm chart")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Administration capabilities"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Terraform, CRDs, Client libraries"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Ansible, Client libraries"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713 Client libraries")))),(0,r.kt)("p",null,"Notes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Automation: Harbor should support webhooks following CloudEvents spec in the ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/goharbor/harbor/issues/17748"},"next release")),(0,r.kt)("li",{parentName:"ul"},"Content Trust and Validation: Harbor announced the deprecation of ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/goharbor/harbor/discussions/16612"},"Notary"),"\nintegration, hence it is not mentioned in the table"),(0,r.kt)("li",{parentName:"ul"},"Multi-tenancy: Harbor, Quay, as well as Dragonfly, operates on a single storage\nbackend (e.g. S3), i.e. the storage of container images is shared between tenants"),(0,r.kt)("li",{parentName:"ul"},"Additional supported artifacts: Harbor announced the deprecation of ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/goharbor/harbor/discussions/15057"},"Chartmuseum"),"\nintegration, hence it is not mentioned in the table")),(0,r.kt)("h3",{id:"conclusion"},"Conclusion"),(0,r.kt)("p",null,"A wide range of open-source container registry projects (Quay, Harbor, Dragonfly,\nKeppel, Portus, Kraken, etc.) has been carefully evaluated based on the two main\nfactors: the open-source health and range of supported features."),(0,r.kt)("p",null,"The open-source software health is crucial and container registry implementation should\npass it. The OSS health check evaluates several important metrics\nof an open source software like whether the code/community/development/design is\nfully open or whether the project's maturity, security, and activity are on the desired\nlevel. This check also evaluates the lock-in risk due to possible single points of\nfailure or internal project conflicts and several other aspects.\nOverall, three projects passed the OSS health checks:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/goharbor/harbor"},"Harbor")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/quay/quay"},"Project Quay")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/dragonflyoss/Dragonfly2"},"Dragonfly"))),(0,r.kt)("p",null,'The above projects were then evaluated from the "supported features" perspective.\nThe ',(0,r.kt)("a",{parentName:"p",href:"#required-and-desirable-features-check"},"Required and desirable features check"),"\ninvestigated the feature set of open-source container registry implementations and\nmapped SCS requirements (and nice-to-haves) against it. The list of required features\nis quite long and contains features that are primarily focused on security\n(authentication, vulnerability scanning, content trust, and validation, etc.),\nscalability (HA mode, registry replication, p2p integration, etc.) and visibility\n(monitoring), see the full list ",(0,r.kt)("a",{parentName:"p",href:"#required-and-desirable-features-check"},"here"),".\nThese requirements should ensure that the selected container registry implementation\ncould be offered by CSPs as a secure and enterprise-ready solution."),(0,r.kt)("p",null,"The following section compares projects Dragonfly, Quay, and Harbor."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/dragonflyoss/Dragonfly2"},"Dragonfly"),' is a healthy open-source project with a growing community\nand CNCF incubating maturity level. It is considered stable, and widely used by many\ncompanies in their production environments. We currently see that it is not as\nfeature-rich as Harbor or Quay, hence it is not considered the best choice here.\nIt seems, that its main aim (currently) is to offer (an efficient, stable, and secure)\ncontainer distribution solution based on p2p technology. This improves download\nefficiency and saves bandwidth across CSPs. It also offers integration possibilities\nthat allow one to use it as a p2p distribution network via a "preheat" API. This\nintegration was implemented in the Harbor project via Dragonfly "preheat" adapter, and\nboth parties may benefit from the integration. Harbor profits from Dragonfly\'s p2p\ndistribution capabilities and on the other hand the Dragonfly project profits from\nHarbor\'s feature-rich container registry "frontend".'),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/quay/quay"},"Quay")," is an open-source project maintained by Red Hat. Its OSS health is\non a good level, the surrounding community is growing, and we consider it to be quite\nmature as it powers enterprise solutions like Red Hat Quay and Quay.io.\nBesides this, there is still a place for OSS health improvement. It is hard to\ndistinguish the risk of project failure caused by low diversity across the companies\nbecause the project's owners/maintainers list is not publicly available and is stored in\nthe Red Hat private repository.\nIts feature set is impressive and this project fulfills all must-haves defined in\nthis document. Quay gives you security over your repositories with image\nvulnerability scanning (Clair integration), content validation (Cosign integration),\nand access controls. Harbor stands out here as it allows users to use also project Trivy\nfor vulnerability scanning. Project Quay also provides a scalable open-source\nplatform to host container images across any size organization. One drawback in\ncomparison to Harbor is that the proxy cache feature is still marked as a\n",(0,r.kt)("a",{parentName:"p",href:"https://docs.projectquay.io/use_quay.html#quay-as-cache-proxy"},"Technology Preview"),",\nhence this feature may not be completely production-ready yet. On the other hand,\nthe project Quay supports ",(0,r.kt)("a",{parentName:"p",href:"https://docs.projectquay.io/use_quay.html#build-support"},"building Dockerfiles"),"\nusing a set of workers on e.g. Kubernetes. Build triggers, such as GitHub webhooks\ncan be configured to automatically build new versions of repositories when new code is\ncommitted. This feature is not supported by the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/goharbor/harbor/issues/6235"},"Harbor project"),"."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/goharbor/harbor"},"Harbor")," is an outstanding open-source, community-led project with fully open and\nwell-documented processes. Its large and thriving community powers the fast-growing\nfeature set and attracts more and more developers and companies to active contributions.\nHarbor's CNCF graduation in 2020 made it one of the best choices for enterprise\ncustomers that want to operate container registries securely and in a large scale.\nIts community size, landscape, and CNCF graduation make a significant difference in\ncomparison to Quay's open-source health capabilities.\nThe list of supported features is also impressive. This project fulfills all must-haves\ndefined in this document and overcome project Quay with a production-ready proxy cache\nfeature and more options that the user may use in case of image vulnerability scanning.\nIn addition, Harbor profits from p2p distribution capabilities via integration of p2p\nsolutions like Kraken and Dragonfly. It is worth mentioning that Harbor, by design,\noperates on a single storage backend (e.g. S3). It means that the storage of container\nimages is shared even when the Harbor instance serves multiple tenants. The same\napproach is used in Quay and Dragonfly projects, but e.g. Keppel uses multi-tenant-aware\nstorage drivers instead so that each customer gets their own separate storage backend.\nCSP that considers offering container registry \"as a service\" solution based on Harbor\nshould be aware of this shared storage backend architecture."),(0,r.kt)("h2",{id:"decision"},"Decision"),(0,r.kt)("p",null,"Based on the research and conclusion above we've decided to use the ",(0,r.kt)("strong",{parentName:"p"},"Harbor")," project\nas a container registry implementation for the SCS ecosystem."))}c.isMDXComponent=!0}}]);