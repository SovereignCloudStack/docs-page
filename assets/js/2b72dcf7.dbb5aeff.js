"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7440],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),d=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=d(n),m=r,h=u["".concat(l,".").concat(m)]||u[m]||c[m]||o;return n?a.createElement(h,i(i({ref:t},p),{},{components:n})):a.createElement(h,i({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var d=2;d<o;d++)i[d]=n[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},9492:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>s,toc:()=>d});var a=n(7462),r=(n(7294),n(3905));const o={title:"SCS Entropy",type:"Standard",status:"Draft",track:"IaaS"},i=void 0,s={unversionedId:"active/scs-0101-v1-entropy",id:"active/scs-0101-v1-entropy",title:"SCS Entropy",description:"Introduction",source:"@site/standards/active/scs-0101-v1-entropy.md",sourceDirName:"active",slug:"/active/scs-0101-v1-entropy",permalink:"/standards/active/scs-0101-v1-entropy",draft:!1,tags:[],version:"current",frontMatter:{title:"SCS Entropy",type:"Standard",status:"Draft",track:"IaaS"},sidebar:"standards",previous:{title:"SCS Flavor Naming Standard",permalink:"/standards/active/scs-0100-v2-flavor-naming"},next:{title:"SSD Flavors",permalink:"/standards/active/scs-0110-v1-ssd-flavors"}},l={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Entropy in information technology",id:"entropy-in-information-technology",level:3},{value:"Real-world uses of entropy",id:"real-world-uses-of-entropy",level:3},{value:"Sources of entropy",id:"sources-of-entropy",level:3},{value:"Entropy in virtual instances",id:"entropy-in-virtual-instances",level:3},{value:"Motivation",id:"motivation",level:2},{value:"Entropy in SCS clouds",id:"entropy-in-scs-clouds",level:2},{value:"Flavors",id:"flavors",level:3},{value:"Images",id:"images",level:3},{value:"Compute nodes",id:"compute-nodes",level:3}],p={toc:d};function c(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("h3",{id:"entropy-in-information-technology"},"Entropy in information technology"),(0,r.kt)("p",null,"Entropy is a concept that is widely used in the scope of information\ntechnology. It is a measurement of the amount of disorder or randomness in\na system. Entropy is used to measure the amount of information in a\nself-contained system, as well as the amount of incertitude that exists in this\nsystem."),(0,r.kt)("h3",{id:"real-world-uses-of-entropy"},"Real-world uses of entropy"),(0,r.kt)("p",null,"Cryptography is a very prominent, albeit not the only application that\nheavily relies on entropy for operations such as creating secure keys.\nWhen the available ",(0,r.kt)("em",{parentName:"p"},"entropy runs out"),", said operations can stall and\ntake an abnormally long amount of time, which in turn can lead to\nmalfunctions, e.g., with OpenSSL or load balancers."),(0,r.kt)("h3",{id:"sources-of-entropy"},"Sources of entropy"),(0,r.kt)("p",null,"In ",(0,r.kt)("em",{parentName:"p"},"traditional baremetal systems")," the amount of incertitude is sourced\nfrom the randomness of the read/write cycles of the disk heads of a disk drive,\nbus timings, or keyboard timings, to name a few."),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"More recent methods")," of generating entropy include measuring IRQ jitter\n(available in Linux since kernel 5.4 or, before that, via a daemon such as\n",(0,r.kt)("a",{parentName:"p",href:"http://www.issihosts.com/haveged/"},"HavegeD"),") as well as dedicated CPU\ninstructions (available in virtually all major CPUs: RDSEED or RDRAND\non x86_64 and RNDR on arm64)."),(0,r.kt)("p",null,"Finally, a dedicated device can be utilized \u2014 if present \u2014 that is\ncalled ",(0,r.kt)("em",{parentName:"p"},"hardware random number generator")," or HRNG for short. For instance,\nthe ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Trusted_Platform_Module"},"Trusted Platform Module"),"\nincludes a HRNG. On Linux systems, the HRNG appears as ",(0,r.kt)("inlineCode",{parentName:"p"},"/dev/hwrng"),".\nNote that, while the dedicated CPU instructions can be construed as\na HRNG, they are not treated as such by the kernel, i.e., they ",(0,r.kt)("em",{parentName:"p"},"do not"),"\nappear as ",(0,r.kt)("inlineCode",{parentName:"p"},"/dev/hwrng"),"!"),(0,r.kt)("p",null,"The Linux kernel combines multiple sources of entropy into a pool. To this\nend, it will use all of the sources discussed so far with one exception:\nthe HRNG must be fed into the pool (if so desired) via the daemon ",(0,r.kt)("inlineCode",{parentName:"p"},"rngd"),".\nThe kernel converts the entropy from the pool into cryptographically\nsecure random numbers that appear under ",(0,r.kt)("inlineCode",{parentName:"p"},"/dev/random")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"/dev/urandom"),"."),(0,r.kt)("p",null,"With kernel 5.18, the algorithm that accomplishes\nsaid conversion has been drastically improved (see\n",(0,r.kt)("a",{parentName:"p",href:"https://web.archive.org/web/20230321040526/https://www.zx2c4.com/projects/linux-rng-5.17-5.18/"},"linux-rng-5.17-18"),"),\nso much so that running out of entropy is virtually ruled out.\nThese patches have now also arrived in the upstream LTS images."),(0,r.kt)("h3",{id:"entropy-in-virtual-instances"},"Entropy in virtual instances"),(0,r.kt)("p",null,"Virtual instances or virtual machines do not have the traditional sources\nof entropy mentioned above. However, the more recent methods mentioned\nabove do work just fine (the CPU instructions are not privileged)."),(0,r.kt)("p",null,"Alternatively, a virtualized HRNG called ",(0,r.kt)("inlineCode",{parentName:"p"},"virtio-rng")," can be established\nthat injects entropy from the host into the instance, where this\nentropy can be sourced optionally from either the host's ",(0,r.kt)("inlineCode",{parentName:"p"},"/dev/random")," or\nsome HRNG in the host. This virtualized HRNG behaves just like a real\none, that is, it appears as ",(0,r.kt)("inlineCode",{parentName:"p"},"/dev/hwrng"),", and the daemon ",(0,r.kt)("inlineCode",{parentName:"p"},"rngd")," must\nbe used to feed it into the kernel's entropy pool."),(0,r.kt)("p",null,"On a side note, the kernel exposes available HRNGs via the special\ndirectory ",(0,r.kt)("inlineCode",{parentName:"p"},"/sys/devices/virtual/misc/hw_random"),". In particular, the\nfile ",(0,r.kt)("inlineCode",{parentName:"p"},"rng_available")," lists availabe HRNGs while the file ",(0,r.kt)("inlineCode",{parentName:"p"},"rng_current"),"\ncontains the HRNG currently used."),(0,r.kt)("p",null,"In summary, with current kernels and CPUs entropy in virtual instances\nis readily available to a sufficient degree. In addition, the host's\nentropy sources can be injected using ",(0,r.kt)("inlineCode",{parentName:"p"},"virtio-rng")," if so desired, e.g.,\nto enable access to a HRNG."),(0,r.kt)("h2",{id:"motivation"},"Motivation"),(0,r.kt)("p",null,"As stated above, good sources of entropy are paramount for many\nimportant applications. This standard ensures that sufficient entropy\nwill be available in virtual instances."),(0,r.kt)("h2",{id:"entropy-in-scs-clouds"},"Entropy in SCS clouds"),(0,r.kt)("h3",{id:"flavors"},"Flavors"),(0,r.kt)("p",null,"It is recommended that all flavors have the following attribute:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"hw_rng:allowed=True\n")),(0,r.kt)("p",null,"The following attributes are optional:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"hw_rng:rate_bytes - The allowed amount of bytes for the the guest\n    to read from the host's entropy per period.\nhw_rng:rate_period - Sets the duration of a read period in seconds.\n")),(0,r.kt)("h3",{id:"images"},"Images"),(0,r.kt)("p",null,"It is recommended to use images having a kernel (patch level) version 5.18\nor up. This condition is already satisfied by every mandatory image defined\nin the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/SovereignCloudStack/standards/blob/main/Standards/scs-0102-v1-image-metadata.md"},"Image Metadata Standard"),"."),(0,r.kt)("p",null,"It is recommended that images activate the attribute ",(0,r.kt)("inlineCode",{parentName:"p"},"hw_rng_model: virtio"),"."),(0,r.kt)("p",null,"The daemon ",(0,r.kt)("inlineCode",{parentName:"p"},"rngd")," must be installed (usually from ",(0,r.kt)("inlineCode",{parentName:"p"},"rng-tools"),"\nor ",(0,r.kt)("inlineCode",{parentName:"p"},"rng-utils"),")."),(0,r.kt)("p",null,"The user may choose to use the ",(0,r.kt)("inlineCode",{parentName:"p"},"virtio-rng")," device via ",(0,r.kt)("inlineCode",{parentName:"p"},"rngd"),"."),(0,r.kt)("h3",{id:"compute-nodes"},"Compute nodes"),(0,r.kt)("p",null,"Compute nodes must use CPUs that offer instructions for accessing\nentropy (such as RDSEED or RDRAND on x86_64 or RNDR on arm64), and\nthese instructions may not be filtered by the hypervisor.\nIf this requirement cannot be verified directly, then at least the\nfollowing two conditions must be satisfied in a virtual instance:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"The special file ",(0,r.kt)("inlineCode",{parentName:"p"},"/proc/sys/kernel/random/entropy_avail")," must contain\nthe value 256 (pinned since kernel 5.18).")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"The number of FIPS 140-2 failures must not exceed 3 out of 1000 blocks\ntested, as determined by ",(0,r.kt)("inlineCode",{parentName:"p"},"cat /dev/random | rngtest -c 1000")," ."))),(0,r.kt)("p",null,"Compute nodes may provide a HRNG via ",(0,r.kt)("inlineCode",{parentName:"p"},"rngd"),"."))}c.isMDXComponent=!0}}]);